!Autor: Robson Vaamonde
!Procedimentos em TI: http://procedimentosemti.com.br
!Bora para Prática: http://boraparapratica.com.br
!Robson Vaamonde: http://vaamonde.com.br
!Facebook Procedimentos em TI: https://www.facebook.com/ProcedimentosEmTi
!Facebook Bora para Prática: https://www.facebook.com/BoraParaPratica
!Instagram Procedimentos em TI: https://www.instagram.com/procedimentoem
!YouTUBE Bora Para Prática: https://www.youtube.com/boraparapratica
!Data de criação: 22/05/2020
!Data de atualização: 22/05/2020
!Versão: 0.01
!Testado e homologado no Cisco Packet Tracer 7.3 e GNS3 2.2.7

!OBSERVAÇÃO IMPORTANTE: NEM TODOS OS RECURSOS DO PROTOCOLO SPANNING TREE SÃO COBRADOS NA NOVA CERTIFICAÇÃO DA CISCO
!CCNAv7 EXAME 200-301, MESMO NÃO SENDO COBRADO, RECOMENDO O SEU ESTUDO A PARTE PARA AJUDAR NO ENTENDIMENTO DO STP.

!STP Portfast: O recurso do STP Portfast (Porta Rápida) faz com que uma Porta do Switch altere imediatamente para o 
!estado de encaminhamento (Forwarding), ignorando os estados de escutando (Listening) e aprendendo (learning), esse
!recurso é configurado somente em Portas de Acesso (Access).

!STP Portfast Trunk: O recurso de STP Portfast Trunk (Porta Rápida de Tronco) tem a mesma finalidade do STP Portfast,
!mais é somente configurado em Portas de Tronco (Trunk) com dispostivos que não são Switches, como por exemplo: Router
!(Roteadores), Server (Servidores), Bridge (Pontes), Access Point (Ponto de Acesso) e etc.

!STP Portfast BPDU Guard: é usado para proteger a topologia do protocolo STP contra ataques relacionados ao BPDU. O 
!BPDU Guard coloca a porta em Desabilitada por Erro (errdisabled) se ela receber quadros BPDU, o BPDU Guard é habilitado
!apenas nas interfaces configuradas com Portfast de Acesso, existe a possibilidade de configurar globalmente com o 
!comando: spanning-tree portfast bpduguard default ou na interface com os comando: spanning-tree bpduguard disable ou
!com o comando: spanning-tree bpduguard enable.

!Outros recursos de Segurança do Protocolo Spanning-Tree: STP Root Guard (Proteção da Porta Raiz), STP Loop Guard (Proteção
!contra falta de Recebimentos de BPDU), UDLD Unidirectional Link Detection (Proteção e Detecção de Links Unidirecionais)
!Switchport Trunk Allowed (Poda (Prunning) de VLANs nos Trunk)- esses recursos não serão configurados nesse vídeo, divido a
!forma da configuração da topologia.

!OBSERVAÇÃO IMPORTANTE: O STP Loop Guard e o UDLD não estão disponíveis para configuração no Cisco Packet Tracer.

!PRIMEIRA ETAPA: Configuração do STP e RSTP Portfast no Switche Layer 3 3560
!Acessando o modo EXEC Privilégiado
enable

	!Acessando o modo de Configuração Global de Comandos
	configure terminal
	
		!Configuração do STP do Switch Layer 3 para ser o Root Bridge das VLANs
		!OBSERVAÇÃO: configurando somente as VLANs associadas no Switch para ser o Root Bridge padrão da Topologia
		spanning-tree vlan 1,50,90-100 root primary
		
		!Configurando o RSTP Rapid-PVST no Switch Layer 3 3560
		!OBSERVAÇÃO: lembre-se de que ser atividado no Switch Root Bridge os demais também precisam ser configurados
		spanning-tree mode rapid-pvst

		!Configurando o Portfast na Interface de Trunk com o Router 2911
		interface fastEthernet 0/24

			!Configurando o modo do STP para Rápida Mudança de Encaminhamento da Interface
			!DICA: em Portas Trunk (Tronco) conectadas em Roteadores ou Servidores é recomendado acelerar a velocidade de 
			!encaminhamento de quadros (Frames) nessas Interfaces, agilizando o processo de convergência da topologia
			!OBSERVAÇÃO: essa configuração não deve ser utilizada em Interfaces de Trunk entre Switches na Topologia
			spanning-tree portfast trunk
			exit
			
		!Configurando o Portfast na Interface de Acesso do Servidor e Access-Point
		interface range fastEthernet 0/1 - 2
		
			!Configurando o modo do STP para Rápida Mudança de Encaminhamento das Interfaces
			!DICA: diferente do comando spanning-tree portfast trunk, o comando spanning-tree portfast é utilizado somente
			!em Interfacea configuradaa no modo de Acesso, não deve ser utilizado em Interfaces configuradas como Trunk
			!OBSERVAÇÃO: Portfast pode ser configurado Globalmente com o comando: spanning-tree portfast default 
			spanning-tree portfast
			
			!Configurando a Protoção do STP BPDU Guard das Interfaces
			!DICA: geralmente em Interfaces configuradas com o Portfast é configurado o recurso de BPDU Guard
			!OBSERVAÇÃO: BPDU Guard pode ser configurado Globalmente com o comando: spanning-tree portfast bpduguard default
			!CUIDADO: habilitar o recurso do BPDU Guard globalmente em Switches que tem Interfaces configuradas como Trunk 
			!pode causar a Falha de Desabilitado por Erro (errdisable)
			spanning-tree bpduguard enable
			end
write

!SEGUNDA ETAPA: Configuração do STP e RSTP Portfast no Switches Layer 2 2960-5
enable
	configure terminal
		spanning-tree mode rapid-pvst
		!OBSERVAÇÃO: o primeiro Switch Layer 2 será o Root Bridge Primary da Topologia das VLANs associadas
		spanning-tree vlan 10,20,30,40 root primary
		interface range fastEthernet 0/1 - 20
			spanning-tree portfast
			spanning-tree bpduguard enable
		end
write

!TERCEIRA ETAPA: Configuração do STP e RSTP Portfast no Switches Layer 2 2960-5
enable
	configure terminal
		spanning-tree mode rapid-pvst
		!OBSERVAÇÃO: o segundo Switch Layer 2 será o Root Bridge Secondary da Topologia das VLANs associadas
		spanning-tree vlan 10,20,30,40 root secondary
		interface range fastEthernet 0/1 - 20
			spanning-tree portfast
			spanning-tree bpduguard enable
		end
write

!Visualizando as configurações da memória RAM
show running-config | section interface
show running-config | section spanning-tree

!Verificando as informações das Interfaces e Trunk
show spanning-tree
show spanning-tree summary
show interface trunk
show interface status
show interfaces gigabitEthernet 0/1 switchport